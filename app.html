<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotFrens - Web3 Platform</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Space+Grotesk:wght@300;400;500;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Space Grotesk', sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 450px;
            min-height: 100vh;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .bg-glow {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.15);
            filter: blur(80px);
            z-index: 0;
        }

        .bg-glow-1 {
            top: 20%;
            left: -100px;
        }

        .bg-glow-2 {
            bottom: 10%;
            right: -50px;
        }

        .api-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 12px;
            z-index: 1000;
            cursor: pointer;
        }

        .api-status.online {
            border-color: #55ff7f;
            color: #55ff7f;
        }

        .api-status.offline {
            border-color: #ff5555;
            color: #ff5555;
        }

        .api-status.testing {
            border-color: #FFD700;
            color: #FFD700;
        }

        .wallet-connect-area {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 10px;
            position: relative;
            z-index: 3;
        }

        .wallet-info {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(0, 152, 234, 0.3);
            box-shadow: 0 0 15px rgba(0, 152, 234, 0.2);
            width: 100%;
            text-align: center;
            display: none;
        }

        .wallet-info.active {
            display: block;
        }

        .wallet-address {
            font-family: 'Orbitron', monospace;
            font-size: 14px;
            color: #0098ea;
            margin: 5px 0;
            word-break: break-all;
            background: rgba(0, 152, 234, 0.1);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid rgba(0, 152, 234, 0.2);
        }

        .wallet-balance {
            font-size: 16px;
            color: #FFD700;
            font-weight: 600;
            margin: 8px 0;
        }

        .logo-container {
            margin-top: 40px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .logo {
            width: 150px;
            height: 150px;
            position: relative;
        }

        .logo svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7));
        }

        .logo-path {
            stroke: #FFD700;
            stroke-width: 2;
            fill: none;
            filter: drop-shadow(0 0 3px #FFD700);
        }

        .logo-node {
            fill: #FFD700;
            filter: drop-shadow(0 0 5px #FFD700);
        }

        .token-display {
            margin: 30px 0;
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
            width: 100%;
            position: relative;
            z-index: 2;
        }

        .token-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .token-amount {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .button-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            margin-top: auto;
            position: relative;
            z-index: 2;
        }

        .nav-button {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 20px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-button:hover {
            background: rgba(30, 30, 30, 0.9);
            border-color: rgba(255, 215, 0, 0.6);
            transform: translateY(-2px);
        }

        .button-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: #FFD700;
            position: relative;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .button-label {
            font-size: 14px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }

        .coming-soon::before {
            content: "Coming Soon";
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FFD700;
            color: #000;
            font-size: 8px;
            padding: 3px 6px;
            border-radius: 8px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .status-message {
            margin: 15px 0;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 14px;
            display: none;
            width: 100%;
            max-width: 400px;
        }

        .status-message.success {
            background: rgba(39, 174, 96, 0.2);
            color: #2ecc71;
            border: 1px solid rgba(39, 174, 96, 0.3);
        }

        .status-message.error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .status-message.loading {
            background: rgba(52, 152, 219, 0.2);
            color: #3498db;
            border: 1px solid rgba(52, 152, 219, 0.3);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pulse-animation {
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            max-width: 90%;
            width: 400px;
            position: relative;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            padding-bottom: 10px;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            color: #FFD700;
            font-size: 18px;
            font-weight: 500;
        }

        .close-modal {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 20px;
            cursor: pointer;
            transition: color 0.3s ease;
            outline: none;
        }

        .close-modal:hover {
            color: #FFD700;
        }

        .payment-amount {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .payment-amount .currency {
            font-size: 24px;
        }

        .payment-amount .amount {
            font-size: 28px;
            font-weight: bold;
            color: #000;
        }

        .payment-amount .description {
            font-size: 16px;
            color: #333;
        }

        .payment-btn {
            width: 100%;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .payment-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        .payment-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* FRENS SCREEN STYLES */
        .frens-screen {
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: #000;
            z-index: 20;
            padding: 20px;
            display: none;
            flex-direction: column;
            overflow-y: auto;
        }

        .screen-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            position: relative;
        }

        .screen-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            color: #FFD700;
            font-weight: 700;
        }

        .back-button {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            position: absolute;
            left: 0;
        }

        .back-icon {
            margin-right: 5px;
            font-size: 14px;
        }

        .back-button:hover {
            color: #FFD700;
        }

        .stats-container {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stats-box {
            flex: 1;
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .stats-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .referral-link-container {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .link-label {
            font-size: 14px;
            color: #FFD700;
            margin-bottom: 10px;
            text-align: center;
        }

        .link-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .referral-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 13px;
            outline: none;
        }

        .link-buttons {
            display: flex;
            gap: 10px;
        }

        .link-button {
            flex: 1;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 8px;
            color: #FFD700;
            font-size: 14px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .link-button:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .premium-status {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .not-premium .status-text {
            color: #ff5555;
            font-weight: 500;
        }

        .premium .status-text {
            color: #55ff7f;
            font-weight: 500;
        }

        .premium-button {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 8px;
            color: #FFD700;
            font-size: 14px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .premium-button:hover {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .premium-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .user-tree {
            margin-bottom: 30px;
        }

        .user-profile {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #FFD700, #B8860B);
            border: 2px solid rgba(255, 215, 0, 0.8);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            overflow: hidden;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .user-name {
            font-size: 16px;
            color: #fff;
            font-weight: 500;
        }

        .tokens-earned {
            font-size: 14px;
            color: #FFD700;
            margin-top: 5px;
            font-weight: 500;
        }

        .direct-referrals {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 20px;
        }

        .referral-card {
            flex: 1;
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 80px;
        }

        .referral-name {
            font-size: 14px;
            color: #fff;
            margin-bottom: 10px;
            word-break: break-all;
        }

        .referral-status {
            font-size: 12px;
            font-weight: 500;
        }

        .referral-status.added {
            color: #55ff7f;
        }

        .referral-status.not-added {
            color: #ff5555;
        }

        .referral-info-box {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .info-title {
            font-size: 16px;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 10px;
            text-align: center;
        }

        .info-list {
            list-style: none;
        }

        .info-list li {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            display: flex;
            align-items: baseline;
        }

        .info-list li:before {
            content: "•";
            color: #FFD700;
            font-weight: bold;
            margin-right: 8px;
        }

        .highlight {
            color: #FFD700;
            font-weight: 600;
        }

        .levels-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 30px;
        }

        .level-card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            min-height: 70px;
        }

        .level-card.no-claim {
            padding: 15px;
        }

        .level-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .level-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 18px;
            color: #FFD700;
            font-weight: 600;
        }

        .level-progress {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }

        .level-rewards {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .reward-amount {
            font-size: 16px;
            font-weight: 600;
            color: #FFD700;
        }

        .claim-button {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.4);
            border-radius: 8px;
            color: #FFD700;
            font-size: 14px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .claim-button:hover:not([disabled]) {
            background: rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .claim-button[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="api-status" id="apiStatus">API: Checking...</div>
    
    <div class="container" id="mainScreen">
        <div class="bg-glow bg-glow-1"></div>
        <div class="bg-glow bg-glow-2"></div>
        
        <div class="wallet-connect-area">
            <div id="ton-connect-ui"></div>
        </div>
        
        <div class="wallet-info" id="walletInfo">
            <div class="wallet-address" id="walletAddress">Not Connected</div>
            <div class="wallet-balance" id="walletBalance">0 TON</div>
        </div>
        
        <div class="status-message" id="statusMessage"></div>
        
        <div class="logo-container">
            <div class="logo">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path class="logo-path" d="M50 10 L10 80 L90 80 Z" />
                    <path class="logo-path" d="M50 10 L50 80" />
                    <path class="logo-path" d="M50 10 L10 80" />
                    <path class="logo-path" d="M50 10 L90 80" />
                    <circle class="logo-node" cx="50" cy="10" r="5" />
                    <circle class="logo-node" cx="10" cy="80" r="5" />
                    <circle class="logo-node" cx="90" cy="80" r="5" />
                    <circle class="logo-node" cx="50" cy="80" r="5" />
                </svg>
            </div>
        </div>
        
        <div class="token-display pulse-animation">
            <div class="token-label">Your Notfrens Balance</div>
            <div class="token-amount" id="tokenBalance">0 NOTF</div>
        </div>
        
        <div class="button-container">
            <div class="nav-button">
                <div class="button-icon">🏆</div>
                <div class="button-label">Rank</div>
            </div>
            
            <div class="nav-button" id="frensButton">
                <div class="button-icon">👥</div>
                <div class="button-label">Frens</div>
            </div>
            
            <div class="nav-button">
                <div class="button-icon">✅</div>
                <div class="button-label">Tasks</div>
            </div>
            
            <div class="nav-button coming-soon">
                <div class="button-icon">🎨</div>
                <div class="button-label">Trade (NFT)</div>
            </div>
        </div>
    </div>

    <!-- TON PAYMENT MODAL -->
    <div class="modal" id="tonPaymentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">💎 Premium Upgrade - 0.05 TON</h3>
                <button class="close-modal" id="closeTonModal">×</button>
            </div>
            
            <div class="payment-amount">
                <span class="currency">💎</span>
                <span class="amount">0.05 TON</span>
                <span class="description">Premium Access</span>
            </div>
            
            <div style="margin-bottom: 20px;">
                <h4 style="color: #FFD700; margin-bottom: 10px;">Premium Benefits:</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 8px 0; color: #fff;">🔓 Level progression unlocked</li>
                    <li style="margin: 8px 0; color: #fff;">💰 Referral rewards enabled</li>
                    <li style="margin: 8px 0; color: #fff;">🏆 Priority support</li>
                    <li style="margin: 8px 0; color: #fff;">📊 Advanced analytics</li>
                    <li style="margin: 8px 0; color: #fff;">⚡ Higher token rewards</li>
                </ul>
            </div>
            
            <button onclick="sendTONPayment()" class="payment-btn" id="tonPayBtn">
                💎 Send 0.05 TON Payment
            </button>
            
            <div style="margin-top: 15px; padding: 10px; background: rgba(52, 152, 219, 0.1); border-radius: 8px; font-size: 12px; color: rgba(255, 255, 255, 0.8);">
                ⚠️ <strong>Important:</strong> Payment will be sent to owner's wallet. After confirmation, premium will be activated automatically.
            </div>
        </div>
    </div>

    <!-- FRENS SCREEN -->
    <div class="frens-screen" id="frensScreen">
        <div class="screen-header">
            <button class="back-button" id="frensBackButton">
                <span class="back-icon">&#10094;</span> Back
            </button>
            <h2 class="screen-title">Frens</h2>
        </div>
        
        <div class="stats-container">
            <div class="stats-box">
                <div class="stats-label">Total</div>
                <div class="stats-value" id="totalEarned">$0</div>
            </div>
            <div class="stats-box">
                <div class="stats-label">Withdrawn</div>
                <div class="stats-value" id="withdrawn">$0</div>
            </div>
        </div>
        
        <div class="referral-link-container">
            <div class="link-label">Referral Link</div>
            <div class="link-actions">
                <input type="text" class="referral-input" id="referralInput" value="Loading..." readonly>
                <div class="link-buttons">
                    <button class="link-button" id="copyButton">Copy</button>
                    <button class="link-button" id="shareButton">Share</button>
                </div>
            </div>
        </div>
        
        <div class="premium-status not-premium" id="premiumStatusDiv">
            <span class="status-text" id="premiumStatusText">Premium ❌</span>
            <button class="premium-button" id="premiumButton" onclick="showTONPayment()">Pay 0.05 TON</button>
        </div>
        
        <div class="user-tree">
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">👤</div>
                <div class="user-name" id="userName">Loading...</div>
                <div class="tokens-earned" id="tokensEarned">0 Tokens Earned from Referrals</div>
            </div>
            
            <div class="direct-referrals" id="directReferrals">
                <div class="referral-card">
                    <div class="referral-name">Slot 1</div>
                    <div class="referral-status not-added">Empty</div>
                </div>
                <div class="referral-card">
                    <div class="referral-name">Slot 2</div>
                    <div class="referral-status not-added">Empty</div>
                </div>
                <div class="referral-card">
                    <div class="referral-name">Slot 3</div>
                    <div class="referral-status not-added">Empty</div>
                </div>
            </div>
            
            <div class="referral-info-box">
                <div class="info-title">💎 Premium Required for Progression 💎</div>
                <ul class="info-list">
                    <li><span class="highlight">100 NOTF tokens</span> for every direct referral</li>
                    <li><span class="highlight">Premium subscription</span> required for level progression</li>
                    <li><span class="highlight">Only premium users</span> can advance through levels</li>
                    <li>Claim payments when levels are complete</li>
                </ul>
            </div>
        </div>
        
        <div class="levels-container" id="levelsContainer">
            <div class="level-card">
                <div class="level-info">
                    <div class="level-name">Level 3</div>
                    <div class="level-progress" id="level3Progress">0/9</div>
                </div>
                <div class="level-rewards">
                    <div class="reward-amount">$30</div>
                    <button class="claim-button" disabled id="claim3Button" onclick="claimReward(3)">Premium Required</button>
                </div>
            </div>
            
            <div class="level-card no-claim">
                <div class="level-info">
                    <div class="level-name">Level 4</div>
                    <div class="level-progress" id="level4Progress">0/27</div>
                </div>
            </div>
            
            <div class="level-card">
                <div class="level-info">
                    <div class="level-name">Level 5</div>
                    <div class="level-progress" id="level5Progress">0/81</div>
                </div>
                <div class="level-rewards">
                    <div class="reward-amount">$300</div>
                    <button class="claim-button" disabled id="claim5Button" onclick="claimReward(5)">Premium Required</button>
                </div>
            </div>
            
            <div class="level-card no-claim">
                <div class="level-info">
                    <div class="level-name">Level 6</div>
                    <div class="level-progress" id="level6Progress">0/243</div>
                </div>
            </div>
            
            <div class="level-card">
                <div class="level-info">
                    <div class="level-name">Level 7</div>
                    <div class="level-progress" id="level7Progress">0/729</div>
                </div>
                <div class="level-rewards">
                    <div class="reward-amount">$1,800</div>
                    <button class="claim-button" disabled id="claim7Button" onclick="claimReward(7)">Premium Required</button>
                </div>
            </div>
            
            <div class="level-card no-claim">
                <div class="level-info">
                    <div class="level-name">Level 8</div>
                    <div class="level-progress" id="level8Progress">0/2187</div>
                </div>
            </div>
            
            <div class="level-card">
                <div class="level-info">
                    <div class="level-name">Level 9</div>
                    <div class="level-progress" id="level9Progress">0/6561</div>
                </div>
                <div class="level-rewards">
                    <div class="reward-amount">$20,000</div>
                    <button class="claim-button" disabled id="claim9Button" onclick="claimReward(9)">Premium Required</button>
                </div>
            </div>
            
            <div class="level-card no-claim">
                <div class="level-info">
                    <div class="level-name">Level 10</div>
                    <div class="level-progress" id="level10Progress">0/19683</div>
                </div>
            </div>
            
            <div class="level-card no-claim">
                <div class="level-info">
                    <div class="level-name">Level 11</div>
                    <div class="level-progress" id="level11Progress">0/59049</div>
                </div>
            </div>
            
            <div class="level-card">
                <div class="level-info">
                    <div class="level-name">Level 12</div>
                    <div class="level-progress" id="level12Progress">0/177147</div>
                </div>
                <div class="level-rewards">
                    <div class="reward-amount">$222,000</div>
                    <button class="claim-button" disabled id="claim12Button" onclick="claimReward(12)">Premium Required</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let tonConnectUI;
        let currentWallet = null;
        let currentUser = null;
        
        // PRODUCTION API BASE - REAL RAILWAY URL
        const API_BASE = 'https://notfrens-app-production.up.railway.app/api';
        
        // Configuration
        const OWNER_TON_ADDRESS = "UQCpLxU30SVhlQ049kja71GohOM43YR3emTT3igMHsntmlkI";
        const TON_AMOUNT = 0.05;

        const elements = {
            apiStatus: document.getElementById('apiStatus'),
            walletInfo: document.getElementById('walletInfo'),
            walletAddress: document.getElementById('walletAddress'),
            walletBalance: document.getElementById('walletBalance'),
            statusMessage: document.getElementById('statusMessage'),
            tokenBalance: document.getElementById('tokenBalance'),
            mainScreen: document.getElementById('mainScreen'),
            frensScreen: document.getElementById('frensScreen'),
            frensButton: document.getElementById('frensButton'),
            frensBackButton: document.getElementById('frensBackButton'),
            copyButton: document.getElementById('copyButton'),
            shareButton: document.getElementById('shareButton'),
            userName: document.getElementById('userName'),
            tokensEarned: document.getElementById('tokensEarned'),
            referralInput: document.getElementById('referralInput'),
            directReferrals: document.getElementById('directReferrals'),
            premiumStatusDiv: document.getElementById('premiumStatusDiv'),
            premiumStatusText: document.getElementById('premiumStatusText'),
            premiumButton: document.getElementById('premiumButton'),
            tonPaymentModal: document.getElementById('tonPaymentModal'),
            closeTonModal: document.getElementById('closeTonModal')
        };

        // API Request Function
        async function makeAPIRequest(endpoint, options = {}) {
            const url = `${API_BASE}${endpoint}`;
            const defaultOptions = {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                ...options
            };

            try {
                console.log('API Request:', url, defaultOptions);
                
                const response = await fetch(url, defaultOptions);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                return { success: true, data };
            } catch (error) {
                console.error('API Error:', error.message);
                return { success: false, error: error.message };
            }
        }

        // API Health Check
        async function checkAPIHealth() {
            elements.apiStatus.textContent = 'API: Testing...';
            elements.apiStatus.className = 'api-status testing';
            
            const result = await makeAPIRequest('/health');
            
            if (result.success) {
                elements.apiStatus.textContent = `API: Online (${result.data.users || 0} users)`;
                elements.apiStatus.className = 'api-status online';
                return true;
            } else {
                elements.apiStatus.textContent = 'API: Offline';
                elements.apiStatus.className = 'api-status offline';
                return false;
            }
        }

        // TON Connect Initialization
        async function initTonConnect() {
            try {
                tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://notfrens-app-production.up.railway.app/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect-ui'
                });

                tonConnectUI.onStatusChange((wallet) => {
                    if (wallet) {
                        currentWallet = wallet;
                        handleWalletConnected(wallet);
                    } else {
                        currentWallet = null;
                        handleWalletDisconnected();
                    }
                });

                if (tonConnectUI.wallet) {
                    currentWallet = tonConnectUI.wallet;
                    handleWalletConnected(tonConnectUI.wallet);
                }
            } catch (error) {
                showStatus('TON Connect failed to load', 'error');
                console.error('TON Connect Error:', error);
            }
        }

        // Wallet Connected Handler
        async function handleWalletConnected(wallet) {
            elements.walletAddress.textContent = wallet.account.address;
            elements.walletInfo.classList.add('active');
            
            await updateWalletBalance(wallet.account.address);
            showStatus('Wallet connected successfully!', 'success');
            await notifyBackendWalletConnection(wallet.account.address);
        }

        // Wallet Disconnected Handler
        function handleWalletDisconnected() {
            elements.walletAddress.textContent = 'Not Connected';
            elements.walletBalance.textContent = '0 TON';
            elements.walletInfo.classList.remove('active');
            showStatus('Wallet disconnected', 'error');
        }

        // Update Wallet Balance
        async function updateWalletBalance(address) {
            try {
                const result = await makeAPIRequest('/ton/balance', {
                    method: 'POST',
                    body: JSON.stringify({ address })
                });

                if (result.success) {
                    elements.walletBalance.textContent = `${result.data.balance} TON`;
                } else {
                    elements.walletBalance.textContent = '0 TON';
                }
            } catch (error) {
                elements.walletBalance.textContent = '0 TON';
            }
        }

        // Notify Backend Wallet Connection
        async function notifyBackendWalletConnection(address) {
            try {
                const userId = getTelegramUserId();
                
                await makeAPIRequest('/ton/connect', {
                    method: 'POST',
                    body: JSON.stringify({
                        telegramId: parseInt(userId),
                        walletAddress: address
                    })
                });
            } catch (error) {
                console.error('Backend notification error:', error);
            }
        }

        // Get Telegram User ID
        function getTelegramUserId() {
            // Try to get user ID from Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
                const user = window.Telegram.WebApp.initDataUnsafe.user;
                if (user && user.id) {
                    console.log('Real Telegram User ID:', user.id);
                    return user.id.toString();
                }
            }
            
            // URL'dan user ID olish
            const urlParams = new URLSearchParams(window.location.search);
            const urlUserId = urlParams.get('user');
            if (urlUserId) {
                console.log('URL User ID:', urlUserId);
                return urlUserId;
            }
            
            // Demo ID (development uchun)
            const demoId = '123456789';
            console.log('Using demo ID:', demoId);
            return demoId;
        }

        // Get Telegram User Data
        function getTelegramUserData() {
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe) {
                const user = window.Telegram.WebApp.initDataUnsafe.user;
                if (user) {
                    return {
                        id: user.id,
                        username: user.username || `User${user.id}`,
                        first_name: user.first_name || 'User',
                        last_name: user.last_name || ''
                    };
                }
            }
            
            // URL'dan user ID olish
            const urlParams = new URLSearchParams(window.location.search);
            const urlUserId = urlParams.get('user');
            
            if (urlUserId) {
                return {
                    id: parseInt(urlUserId),
                    username: `User${urlUserId}`,
                    first_name: 'User',
                    last_name: ''
                };
            }
            
            // Demo foydalanuvchi (test uchun)
            return {
                id: 123456789,
                username: 'DemoUser',
                first_name: 'Demo',
                last_name: 'User'
            };
        }

        // Show TON Payment Modal
        function showTONPayment() {
            if (!currentWallet) {
                showStatus('Please connect your TON wallet first!', 'error');
                return;
            }
            
            elements.tonPaymentModal.style.display = 'flex';
        }

        // Send TON Payment
        async function sendTONPayment() {
            if (!currentWallet) {
                showStatus('Wallet not connected!', 'error');
                return;
            }
            
            try {
                const payBtn = document.getElementById('tonPayBtn');
                payBtn.disabled = true;
                payBtn.textContent = 'Processing...';
                
                showStatus('Preparing TON payment...', 'loading');
                
                const userId = getTelegramUserId();
                const comment = `NotFrens Premium Payment - User ID: ${userId}`;
                
                // Sodda TON transfer (xavfsiz)
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 300, // 5 minut
                    messages: [{
                        address: OWNER_TON_ADDRESS,
                        amount: "50000000", // 0.05 TON (nanoton)
                        payload: btoa(comment) // Base64 encoded comment
                    }]
                };
                
                console.log('Sending TON transaction:', transaction);
                
                const result = await tonConnectUI.sendTransaction(transaction);
                
                showStatus('Payment sent! Verifying...', 'success');
                
                // Backend'ga to'lov ma'lumotini yuborish
                const paymentResult = await makeAPIRequest('/payment/ton', {
                    method: 'POST',
                    body: JSON.stringify({
                        telegramId: parseInt(userId),
                        type: 'ton_direct',
                        hash: result.boc,
                        from: currentWallet.account.address,
                        to: OWNER_TON_ADDRESS,
                        amount: 0.05,
                        comment: comment,
                        usdtEquivalent: 11 // 11 USDT'ga teng deb hisoblaymiz
                    })
                });
                
                if (paymentResult.success) {
                    elements.tonPaymentModal.style.display = 'none';
                    updatePremiumStatus(true);
                    showStatus('🎉 Premium activated! Level progression unlocked!', 'success');
                    await loadUserData();
                } else {
                    throw new Error(paymentResult.error || 'Payment verification failed');
                }
                
            } catch (error) {
                console.error('Payment error:', error);
                showStatus('Payment failed: ' + error.message, 'error');
            } finally {
                const payBtn = document.getElementById('tonPayBtn');
                payBtn.disabled = false;
                payBtn.textContent = '💎 Send 0.05 TON Payment';
            }
        }

        // Show Status Message
        function showStatus(message, type) {
            const statusEl = elements.statusMessage;
            statusEl.className = `status-message ${type}`;
            
            if (type === 'loading') {
                statusEl.innerHTML = `<span class="loading-spinner"></span>${message}`;
            } else {
                statusEl.textContent = message;
            }
            
            statusEl.style.display = 'block';

            if (type !== 'loading') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }

        // Load User Data
        async function loadUserData() {
            try {
                const userId = getTelegramUserId();
                const userData = getTelegramUserData();
                
                showStatus('Ma\'lumotlar yuklanmoqda...', 'loading');
                
                const result = await makeAPIRequest(`/telegram-user/${userId}`);
                
                if (result.success && result.data.user) {
                    currentUser = result.data.user;
                    updateUserInterface(currentUser);
                    showStatus('Ma\'lumotlar muvaffaqiyatli yuklandi!', 'success');
                    console.log('Real user data loaded:', currentUser);
                    return true;
                } else {
                    throw new Error(result.error || 'API dan ma\'lumot olmadi');
                }
            } catch (error) {
                console.error('API bilan bog\'lanishda xatolik:', error);
                
                // Demo ma'lumotlarni yuklash (0 dan boshlash)
                const userData = getTelegramUserData();
                loadDemoData(userData);
                
                showStatus('Demo rejimda ishlayapti (offline)', 'error');
                return false;
            }
        }

        // Load Demo Data (Starting from ZERO)
        function loadDemoData(userData = null) {
            const user = userData || getTelegramUserData();
            
            currentUser = {
                telegramId: user.id,
                username: user.username,
                firstName: user.first_name,
                lastName: user.last_name,
                totalDirectReferrals: 0, // 0 dan boshlash
                referralLink: generateReferralLink(user.id),
                isPremium: false,
                levels: generateEmptyLevels(),
                directReferrals: [], // Bo'sh array
                stats: {
                    totalTokensEarned: 0,
                    levelsCompleted: 0,
                    totalEarningsPotential: 0
                }
            };
            
            updateUserInterface(currentUser);
            console.log('Demo data loaded (starting from zero):', currentUser);
        }

        // Generate Referral Link
        function generateReferralLink(userId) {
            return `https://t.me/not_frens_bot?start=ref${userId}`;
        }

        // Generate Empty Levels
        function generateEmptyLevels() {
            const levels = {};
            const levelRequirements = [0, 1, 3, 9, 27, 81, 243, 729, 2187, 6561, 19683, 59049, 177147];
            const levelRewards = [0, 0, 0, 30, 0, 300, 0, 1800, 0, 20000, 0, 0, 222000];
            
            for (let i = 1; i <= 12; i++) {
                levels[i] = {
                    current: 0, // Hamma levellar 0 dan boshlaydi
                    required: levelRequirements[i],
                    completed: false,
                    reward: levelRewards[i],
                    hasReward: levelRewards[i] > 0,
                    premiumRequired: i >= 3, // 3-leveldan boshlab premium kerak
                    canProgress: false
                };
            }
            
            return levels;
        }

        // Update User Interface
        function updateUserInterface(user) {
            if (!user) return;
            
            // Token balansini 0 dan boshlash
            const totalTokens = user.totalDirectReferrals * 100;
            elements.tokenBalance.textContent = `${totalTokens} NOTF`;
            
            // User ma'lumotlari
            elements.userName.textContent = `@${user.username}`;
            elements.tokensEarned.textContent = `${totalTokens} Tokens Earned from Referrals`;
            
            // Referal linkni to'g'ri ko'rsatish
            const referralLink = user.referralLink || generateReferralLink(user.telegramId);
            elements.referralInput.value = referralLink;
            
            // Premium statusni yangilash
            updatePremiumStatus(user.isPremium);
            
            // Direct referrallarni yangilash
            updateDirectReferrals(user.directReferrals || []);
            
            // Levelllarni yangilash
            if (user.levels) {
                updateLevels(user.levels);
            }
            
            console.log('User interface updated:', user);
        }

        // Update Premium Status
        function updatePremiumStatus(isPremium) {
            if (isPremium) {
                elements.premiumStatusDiv.className = 'premium-status premium';
                elements.premiumStatusText.textContent = 'Premium ✅';
                elements.premiumButton.style.display = 'none';
                
                if (currentUser) {
                    currentUser.isPremium = true;
                    // Update levels with premium access
                    updateLevels(currentUser.levels);
                }
            } else {
                elements.premiumStatusDiv.className = 'premium-status not-premium';
                elements.premiumStatusText.textContent = 'Premium ❌';
                elements.premiumButton.style.display = 'block';
            }
        }

        // Update Direct Referrals
        function updateDirectReferrals(referrals) {
            elements.directReferrals.innerHTML = '';
            
            for (let i = 0; i < 3; i++) {
                const referral = referrals[i];
                const card = document.createElement('div');
                card.className = 'referral-card';
                
                if (referral) {
                    card.innerHTML = `
                        <div class="referral-name">@${referral.username}</div>
                        <div class="referral-status added">Added (+100 tokens)</div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="referral-name">Slot ${i + 1}</div>
                        <div class="referral-status not-added">Empty</div>
                    `;
                }
                
                elements.directReferrals.appendChild(card);
            }
        }

        // Update Levels
        function updateLevels(levels) {
            Object.keys(levels).forEach(levelNum => {
                const level = levels[levelNum];
                const progressElement = document.getElementById(`level${levelNum}Progress`);
                const claimButton = document.getElementById(`claim${levelNum}Button`);
                
                if (progressElement) {
                    progressElement.textContent = `${level.current}/${level.required}`;
                    
                    if (level.completed && currentUser && currentUser.isPremium) {
                        progressElement.style.color = '#55ff7f';
                        
                        if (claimButton && level.reward > 0) {
                            claimButton.disabled = false;
                            claimButton.textContent = 'Claim';
                            claimButton.style.opacity = '1';
                            claimButton.style.background = 'rgba(255, 215, 0, 0.3)';
                        }
                    } else if (level.completed && currentUser && !currentUser.isPremium) {
                        progressElement.style.color = '#ff9500';
                        
                        if (claimButton && level.reward > 0) {
                            claimButton.textContent = 'Premium Required';
                            claimButton.disabled = true;
                            claimButton.style.opacity = '0.5';
                        }
                    } else {
                        if (claimButton && level.reward > 0) {
                            claimButton.textContent = currentUser && currentUser.isPremium ? 'Not Complete' : 'Premium Required';
                            claimButton.disabled = true;
                            claimButton.style.opacity = '0.5';
                        }
                    }
                }
            });
        }

        // Claim Reward
        async function claimReward(level) {
            if (!currentUser) {
                showStatus('Please load user data first!', 'error');
                return;
            }

            if (!currentUser.isPremium) {
                showStatus('Premium required for claiming rewards!', 'error');
                showTONPayment();
                return;
            }
            
            const button = document.getElementById(`claim${level}Button`);
            const originalText = button.textContent;
            
            button.textContent = 'Claiming...';
            button.disabled = true;

            const result = await makeAPIRequest('/telegram-claim', {
                method: 'POST',
                body: JSON.stringify({
                    telegramId: currentUser.telegramId,
                    level: level
                })
            });

            if (result.success) {
                const claimData = result.data.claimRequest;
                showStatus(`🎉 Claim submitted! Level ${claimData.level}: ${claimData.amount.toLocaleString()}`, 'success');
                button.textContent = 'Claimed ✅';
                button.style.background = 'rgba(46, 204, 113, 0.3)';
                button.style.borderColor = 'rgba(46, 204, 113, 0.6)';
            } else {
                showStatus(`❌ Claim failed: ${result.error}`, 'error');
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Frens button
            elements.frensButton?.addEventListener('click', function() {
                elements.mainScreen.style.display = 'none';
                elements.frensScreen.style.display = 'flex';
            });
            
            // Back button
            elements.frensBackButton?.addEventListener('click', function() {
                elements.frensScreen.style.display = 'none';
                elements.mainScreen.style.display = 'flex';
            });
            
            // Close modal
            elements.closeTonModal?.addEventListener('click', function() {
                elements.tonPaymentModal.style.display = 'none';
            });

            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === elements.tonPaymentModal) {
                    elements.tonPaymentModal.style.display = 'none';
                }
            });
            
            // Copy button
            elements.copyButton?.addEventListener('click', function() {
                const referralInput = elements.referralInput;
                referralInput.select();
                referralInput.setSelectionRange(0, 99999);
                
                try {
                    document.execCommand('copy');
                    this.textContent = 'Copied!';
                    this.style.background = 'rgba(46, 204, 113, 0.3)';
                    
                    setTimeout(() => {
                        this.textContent = 'Copy';
                        this.style.background = 'rgba(255, 215, 0, 0.2)';
                    }, 2000);
                } catch (err) {
                    navigator.clipboard.writeText(referralInput.value);
                }
            });
            
            // Share button
            elements.shareButton?.addEventListener('click', function() {
                const referralLink = elements.referralInput.value;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Join NotFrens',
                        text: 'Check out this awesome crypto project! Use my referral link:',
                        url: referralLink
                    });
                } else {
                    navigator.clipboard.writeText(referralLink);
                    this.textContent = 'Copied!';
                    this.style.background = 'rgba(46, 204, 113, 0.3)';
                    
                    setTimeout(() => {
                        this.textContent = 'Share';
                        this.style.background = 'rgba(255, 215, 0, 0.2)';
                    }, 2000);
                }
            });
        }

        // Initialize Zero State
        function initializeZeroState() {
            // Token balansini 0 qilib qo'yish
            elements.tokenBalance.textContent = '0 NOTF';
            
            // Referal ma'lumotlarini 0 qilib qo'yish
            elements.tokensEarned.textContent = '0 Tokens Earned from Referrals';
            
            // Stats'ni 0 qilib qo'yish
            const totalEarned = document.getElementById('totalEarned');
            const withdrawn = document.getElementById('withdrawn');
            
            if (totalEarned) totalEarned.textContent = '$0';
            if (withdrawn) withdrawn.textContent = '$0';
            
            // Direct referrallarni bo'sh qilib qo'yish
            updateDirectReferrals([]);
            
            console.log('UI initialized with zero state');
        }

        // Initialize App
        async function initializeApp() {
            setupEventListeners();
            await initTonConnect();
            
            // Telegram WebApp'ni ishga tushirish
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                
                const telegramUser = getTelegramUserData();
                console.log('Telegram User:', telegramUser);
            }
            
            // API holatini tekshirish
            const apiHealthy = await checkAPIHealth();
            
            // UI'ni 0 holat bilan boshlash
            initializeZeroState();
            
            // Foydalanuvchi ma'lumotlarini yuklash
            setTimeout(() => {
                loadUserData();
            }, 1000);
        }

        // Document Ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 NotFrens App Starting - PRODUCTION MODE');
            console.log('📡 API Base:', API_BASE);
            console.log('💎 Owner Address:', OWNER_TON_ADDRESS);
            console.log('✅ All systems ready - starting from ZERO');
            
            initializeApp();
        });

        // Global functions
        window.showTONPayment = showTONPayment;
        window.sendTONPayment = sendTONPayment;
        window.claimReward = claimReward;
        window.loadUserData = loadUserData;
        window.checkAPIHealth = checkAPIHealth;
    </script>
</body>
</html>
